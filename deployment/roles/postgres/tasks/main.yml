- name: Add postgres apt key
  apt_key: url=https://www.postgresql.org/media/keys/ACCC4CF8.asc

- name: Add postgres apt repository
  apt_repository: repo='deb http://apt.postgresql.org/pub/repos/apt/ wheezy-pgdg main'
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version == '7'

- name: (jessie) Add postgres apt repository
  apt_repository: repo='deb http://apt.postgresql.org/pub/repos/apt/ jessie-pgdg main'
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version == '8'

- name: ensure apt cache is up to date
  apt: update_cache=yes

- name: install libssl-dev from backports (jessie)
  apt: name=libssl-dev default_release=jessie-backports state=latest
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version == '8'

- name: install libssl-dev from backports (wheezy)
  apt: name=libssl-dev default_release=wheezy-backports state=latest
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version == '7'

- name: ensure packages are installed (wheezy)
  apt: name={{item}} default_release=wheezy-pgdg state=latest
  with_items:
      - postgresql
      - libpq-dev
      - python-psycopg2
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version == '7'

- name: ensure packages are installed (jessie)
  apt: name={{item}} default_release=jessie-pgdg state=latest
  with_items:
      - postgresql
      - libpq-dev
      - python-psycopg2
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version == '8'
